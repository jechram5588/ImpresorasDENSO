„
QMENSAJE$=""
QQRCODETXT$=""
QDATEFORMAT$="YYYYMMDD"
QARRAYLIMIT%=1000
QWAIT%=100
QWAIT2%=25
QERRORES%=0
QTIEMPO%=0
QPANTMEN%=0
DO%=262
DOS%=277
RE%=294
RES%=311
MI%=330
FA%=349
FAS%=370
SOL%=392
SOLS%=411
LA%=440
LAS%=466
SI%=494
PRTXT "INICIO"
PRINTFEED
QDISPLAYOUT%=100
QDISPLAYIN%=110
INC%=0
QPORT%=5
QKEY$=""
QNET$=""
GOSUB ZINICIO
ZINICIO: 
CHDIR "/c"
RUN "su -p pass admin"
OPEN "console:" FOR OUTPUT AS QDISPLAYOUT%
GOSUB ZCLEARARRAY
GOSUB ZMUSICA
GOSUB ZGETSERIALNUMBER
COMSET QPORT%,"",CHR$(13),"+",CHR$(13),50
ON COMSET QPORT% GOSUB ZESCUCHALAN
COMSET QPORT% ON
ON KEY 1 GOSUB ZETIQUITAS2
KEY 1 ON
ON KEY 2 GOSUB ZETIQUITAS9
KEY 2 ON
ON KEY 3 GOSUB ZETIQUITA4311
KEY 3 ON
ON KEY 4 GOSUB ZETIQUITA4671
KEY 4 ON
ON KEY 10 GOSUB ZMUESTRAFECHA
KEY 10 ON
ON KEY 12 GOSUB ZCONFIGFECHA
KEY 12 ON
ON KEY 17 GOSUB ZFEED
KEY 17 ON
QMENSAJE$=STR$(INC%)+"1-S2 2-S9" : GOSUB ZPANTALLA
GOSUB ZMAINLOOP
RETURN
ZMAINLOOP: 
IF INC%>10 THEN INC%=0
IF QTIEMPO%>25 THEN QTIEMPO%=0 ELSE QTIEMPO%=QTIEMPO%+1
IF QTIEMPO%=0 THEN GOSUB ZMOSTRAROPCIONES
IF QKEY$="S2" THEN QFILE$="S2" : QKEY$="" : GOSUB ZCREAETIQUETA
IF QKEY$="S9" THEN QFILE$="S9" : QKEY$="" : GOSUB ZCREAETIQUETA
IF QKEY$="4311" THEN QFILE$="4311" : QKEY$="" : GOSUB ZCREAETIQUETA
IF QKEY$="4671" THEN QFILE$="4671" : QKEY$="" : GOSUB ZCREAETIQUETA
GOSUB ZWAIT2
GOSUB ZMAINLOOP
RETURN
ZMOSTRAROPCIONES: 
IF QPANTMEN%=0 THEN 
QMENSAJE$="3-4311 4-4671" : GOSUB ZPANTALLA
QPANTMEN%=1
ELSE
QMENSAJE$="1-S2 2-S9" : GOSUB ZPANTALLA
QPANTMEN%=0
END IF
RETURN
ZFEED: 
FORMFEED
RETURN
ZETIQUITAS2: 
QKEY$="S2"
RETURN
ZETIQUITAS9: 
QKEY$="S9"
RETURN
ZETIQUITA4311: 
QKEY$="4311"
RETURN
ZETIQUITA4671: 
QKEY$="4671"
RETURN
ZCONFIGFECHA: 
OPEN "CONSOLE:" FOR INPUT AS QDISPLAYIN%
GOSUB ZDISPCLEAR
GOSUB ZDESACTIVAKEYS
QFECHQNET$=""
QHORQNET$=""
QASK$=""
ZCONFIGASK: 
PRINT #QDISPLAYOUT%, "1:CONFIGURAR"
PRINT #QDISPLAYOUT%, "0:CANCELAR";
QASK$=INPUT$(1,QDISPLAYIN%)
IF QASK$<>"1" THEN GOTO ZFECHAEND
GOSUB ZDISPCLEAR
ZCONFIGDATE: 
PRINT #QDISPLAYOUT%, "FECHA YYMMDD"
FOR QI%=0 TO 5
QFECHQNET$=QFECHQNET$+INPUT$(1,QDISPLAYIN%)
GOSUB ZDISPCLEAR
PRINT #QDISPLAYOUT%, "FECHA YYMMDD"
PRINT #QDISPLAYOUT%, QFECHQNET$;
GOSUB ZWAIT2
NEXT
DATE$=QFECHQNET$
GOSUB ZDISPCLEAR
ZCONFIGHOUR: 
PRINT #QDISPLAYOUT%, "HORA HHMMSS"
FOR QI%=0 TO 5
QHORQNET$=QHORQNET$+INPUT$(1,QDISPLAYIN%)
GOSUB ZDISPCLEAR
PRINT #QDISPLAYOUT%, "HORA HHMMSS"
PRINT #QDISPLAYOUT%, QHORQNET$;
GOSUB ZWAIT2
NEXT
FORMAT TIME$ "HHMMSS"
TIME$=QHORQNET$
GOSUB ZMUESTRAFECHA
GOTO ZFECHAEND
ZFECHAEND: 
GOSUB ZACTIVAKEYS
CLOSE QDISPLAYIN%
RETURN
ZMUESTRAFECHA: 
GOSUB ZDISPCLEAR
FORMAT DATE$ "DD/MM/YYYY"
FORMAT TIME$ "HH:MM:SS"
PRINT #QDISPLAYOUT%, DATE$("F")
PRINT #QDISPLAYOUT%, TIME$("F");
GOSUB ZWAIT
GOSUB ZWAIT
GOSUB ZDISPCLEAR
GOSUB ZACTIVAKEYS
GOSUB ZMOSTRAROPCIONES
RETURN
ZDESACTIVAKEYS: 
KEY 1 OFF
KEY 2 OFF
KEY 3 OFF
KEY 4 OFF
KEY 10 OFF
KEY 12 OFF
KEY 17 OFF
RETURN
ZACTIVAKEYS: 
KEY 1 ON
KEY 2 ON
KEY 3 ON
KEY 4 ON
KEY 10 ON
KEY 12 ON
KEY 17 ON
RETURN
ZDISPCLEAR: 
PRINT #QDISPLAYOUT%, CHR$(155)+"2J";
RETURN
ZESCUCHALAN: 
QNET$=COMBUF$(QPORT%)
QMENSAJE$=STR$(INC%)+"'"+QNET$+"'" : GOSUB ZPANTALLA
INC%=INC%+1
IF QNET$="EXIT" THEN GOSUB ZEND
IF QNET$="S2" THEN QFILE$="S2" : QNET$="" : GOSUB ZCREAETIQUETA
IF QNET$="S9" THEN QFILE$="S9" : QNET$="" : GOSUB ZCREAETIQUETA
IF QNET$="4311" THEN QFILE$="4311" : QNET$="" : GOSUB ZCREAETIQUETA
IF QNET$="4671" THEN QFILE$="4671" : QNET$="" : GOSUB ZCREAETIQUETA
GOSUB ZWAIT2
COMSET QPORT% ON
RETURN
ZGETSERIALNUMBER: 
OPEN "C:SERIAL.TXT" FOR INPUT AS 72
IF QERR% THEN 
QSERIALNUMBER%=1
ELSE
QTMP$=INPUT$(LOF(72),72)
QSERIALNUMBER%=VAL(QTMP$)
END IF
CLOSE 72
RETURN
ZSAVESERIALNUMBER: 
ON ERROR GOTO ZSAVESERIALNUMBER
IF QERRORES%>3 THEN RETURN ELSE QERRORES%=QERRORES%+1
OPEN "C:SERIAL.TXT" FOR OUTPUT AS 72
PRINT #72, STR$(QSERIALNUMBER%)
CLOSE 72
QERRORES%=0
GOSUB ZWAIT2
RETURN
ZPANTALLA: 
GOSUB ZDISPCLEAR
PRINT #QDISPLAYOUT%, "    ITA v1.0"
QL%=LEN(QMENSAJE$)
QL%=15-QL%
QSPACE$=""
IF QL%=1 THEN QSPACE$=""
IF QL%=2 THEN QSPACE$=" "
IF QL%=3 THEN QSPACE$=" "
IF QL%=4 THEN QSPACE$="  "
IF QL%=5 THEN QSPACE$="  "
IF QL%=6 THEN QSPACE$="   "
IF QL%=7 THEN QSPACE$="   "
IF QL%=8 THEN QSPACE$="    "
IF QL%=9 THEN QSPACE$="    "
PRINT #QDISPLAYOUT%, QSPACE$+QMENSAJE$;
RETURN
ZMUSICA: 
QMENSAJE$="INICIANDO" : GOSUB ZPANTALLA
SOUND DO%,10 : SOUND DO%,10 : SOUND DO%,10 : SOUND FA%,20 : SOUND LA%,20
SOUND DO%,10 : SOUND DO%,10 : SOUND DO%,10 : SOUND FA%,20 : SOUND LA%,20
SOUND FA%,10 : SOUND FA%,10 : SOUND MI%,10 : SOUND MI%,10 : SOUND RE%,10 : SOUND RE%,20 : SOUND DO%,20
RETURN
ZIMPRIMEARCHIVO: 
QMENSAJE$="IMPRIMIENDO" : GOSUB ZPANTALLA
CLL
CLIP ON
EXECUTE "TMP:PRINTFILE.FMT"
PRINTFEED
GOSUB ZWAIT
RETURN
ZEND: 
QMENSAJE$="EXIT ITA v1.0"
GOSUB ZPANTALLA
COMSET 5 OFF
CLOSE QDISPLAYOUT%
END
RETURN
ZWAIT: 
QWAITTIME%=TICKS+QWAIT%
WHILE TICKS<QWAITTIME% : WEND
RETURN
ZWAIT2: 
QWAITTIME2%=TICKS+QWAIT2%
WHILE TICKS<QWAITTIME2% : WEND
RETURN
ZCREAETIQUETA: 
QLFFILENAME$="C:"+QFILE$+".TXT"
CLOSE 76
OPEN QLFFILENAME$ FOR INPUT AS 76
QFILEPRINTED%=0
QQRCODETXT$=""
WHILE NOT (EOF(76) OR QSTOPPRINTINGLABELS%)
LINE INPUT #76, QDATALINE$
IF INSTR(LEFT$(QDATALINE$,15),"LAYOUT INPUT") THEN 
QLINEFLAG%=1
QSTART%=0
END IF
IF INSTR(LEFT$(QDATALINE$,15),"LAYOUT END") THEN QLINEFLAG%=2
IF INSTR(LEFT$(QDATALINE$,15),"STORE") THEN 
GOSUB ZWRITETOARRAY
ELSE IF QLINEFLAG%=1 THEN 
IF QSTART%>0 THEN 
QSPECIAL%=0
IF INSTR(QDATALINE$,"@") THEN 
IF NOT QERR% THEN QSPECIAL%=1
END IF
IF QSPECIAL%>0 THEN GOSUB ZSPECIALDATA
GOSUB ZWRITETOARRAY
END IF
QSTART%=QSTART%+1
END IF
IF QLINEFLAG%=2 THEN 
GOSUB ZWRITETOFILE
GOSUB ZIMPRIMEARCHIVO
GOSUB ZCLEARARRAY
QFILEPRINTED%=1
QCOUNTER%=QCOUNTER%+1 : GOSUB ZINCREMENTSERIALNUMBER
END IF
WEND
CLOSE 76
IF NOT QFILEPRINTED% THEN 
QMENSAJE$="Error en Crear Etiqueta"
GOSUB ZPANTALLA
END IF
RETURN
ZSPECIALDATA: 
QSTART%=0
QERR%=0
QNEWDATALINE$=""
QLEN%=LEN(QDATALINE$)
FOR QI%=1 TO QLEN% STEP 1
QSINGLECHAR$=MID$(QDATALINE$,QI%,1)
QSPECIALCHAR$=MID$(QDATALINE$,QI%,2)
IF QSPECIALCHAR$="@Y" THEN 
GOSUB ZGETYEARCODE
QNEWDATALINE$=QNEWDATALINE$+QREPLACESTR$
QI%=QI%+1
ELSE IF QSPECIALCHAR$="@M" THEN 
GOSUB ZGETMONTHCODE
QNEWDATALINE$=QNEWDATALINE$+QREPLACESTR$
QI%=QI%+1
ELSE IF QSPECIALCHAR$="@T" THEN 
GOSUB ZGETTIME
QNEWDATALINE$=QNEWDATALINE$+QREPLACESTR$
QI%=QI%+1
ELSE IF QSPECIALCHAR$="@P" THEN 
QNEWDATALINE$=QNEWDATALINE$+QFILE$
QI%=QI%+1
ELSE IF QSPECIALCHAR$="@D" THEN 
GOSUB ZGETDATE
QNEWDATALINE$=QNEWDATALINE$+QREPLACESTR$
QI%=QI%+1
ELSE IF QSPECIALCHAR$="@S" THEN 
QNEWDATALINE$=QNEWDATALINE$+FORMAT$(STR$(QSERIALNUMBER%),"00000")
QI%=QI%+1
ELSE
QNEWDATALINE$=QNEWDATALINE$+QSINGLECHAR$
END IF
NEXT QI%
QDATALINE$=QNEWDATALINE$
RETURN
ZGETYEARCODE: 
QREPLACESTR$=""
FORMAT DATE$ "YY"
QREPLACESTR$=DATE$("F")
IF QREPLACESTR$="19" THEN QREPLACESTR$="C"
IF QREPLACESTR$="20" THEN QREPLACESTR$="D"
IF QREPLACESTR$="21" THEN QREPLACESTR$="E"
IF QREPLACESTR$="22" THEN QREPLACESTR$="F"
IF QREPLACESTR$="23" THEN QREPLACESTR$="G"
RETURN
ZGETMONTHCODE: 
QREPLACESTR$=""
FORMAT DATE$ "MM"
QREPLACESTR$=DATE$("F")
RETURN
ZGETTIME: 
FORMAT TIME$ "HH:MM:SS"
ZGETTIMEFROMPRINTER: 
QERR%=0
QREPLACESTR$=TIME$("F")
IF QERR% THEN 
END IF
RETURN
ZGETDATE: 
FORMAT DATE$ QDATEFORMAT$
ZGETDATEFROMPRINTER: 
QERR%=0
QREPLACESTR$=DATE$("F")
IF QERR% THEN 
END IF
RETURN
ZWRITETOFILE: 
ON ERROR GOTO ZWRITETOFILE2
KILL "TMP:PRINTFILE.FMT"
ZWRITETOFILE2: 
OPEN "TMP:PRINTFILE.FMT" FOR OUTPUT AS 78
QQRCODE%=0
FOR I%=1 TO QARRAYINC% STEP 1
QTEMPLINE$=QDATAARRAY$(I%)
QERR%=0
QIDX%=INSTR(QTEMPLINE$,"QRCODE")
IF QIDX%>0 THEN 
IF NOT QERR% THEN QQRCODE%=1
END IF
IF QQRCODE%>=1 THEN GOSUB ZSETQRCODE
PRINT #78, QDATAARRAY$(I%)
NEXT I%
CLOSE 78
GOSUB ZWAIT
RETURN
ZSETQRCODE: 
QQRCODE%=QQRCODE%+1
QIDX%=INSTR(QDATAARRAY$(I%),"PB")
IF QIDX%=0 THEN QIDX%=INSTR(QDATAARRAY$(I%),"PRBAR")
IF QIDX%=0 THEN RETURN
QQRCODE%=0
QIDX%=LEN(QDATAARRAY$(I%))
QIDX%=QIDX%-INSTR(QDATAARRAY$(I%),CHR$(34))
QTEMPCODE$=RIGHT$(QDATAARRAY$(I%),QIDX%)
QIDX%=INSTR(QTEMPCODE$,CHR$(34))
QTEMPCODE$=LEFT$(QTEMPCODE$,QIDX%-1)
QQRCODETXT$=QQRCODETXT$+QTEMPCODE$
RETURN
ZWRITETOARRAY: 
IF QDIMARRAY%=0 THEN 
DIM QDATAARRAY$(QARRAYLIMIT%)
QDIMARRAY%=1
END IF
QARRAYINC%=QARRAYINC%+1
QDATAARRAY$(QARRAYINC%)=QDATALINE$
IF QARRAYINC%>=QARRAYLIMIT% THEN 
QLOGERROR$="Error: Label lines exceeds maximum. Increase program maximum." : GOSUB ZLOGERROR
QSTOPPRINTINGLABELS%=1
END IF
RETURN
ZCLEARARRAY: 
IF QDIMARRAY%=0 THEN 
DIM QDATAARRAY$(QARRAYLIMIT%)
QDIMARRAY%=1
END IF
FOR I%=1 TO QARRAYLIMIT% STEP 1
QDATAARRAY$(I%)=""
NEXT I%
QARRAYINC%=0
QLINEFLAG%=0
QSTART%=0
RETURN
ZCHECKFORFILE: 
QFILEFOUND%=0 : QFNAME$=QFILENAME$
RUN "su -p pass admin" : 'Default to admin rights when looking for files.
QFULLFOLDERFILENAME$=QLABELFILEFOLDER$+QFILENAME$
QFNAME$=FILENAME$(QFULLFOLDERFILENAME$)
IF QFNAME$=QFILENAME$ THEN QFILEFOUND%=1
RETURN
ZGETDATECODESFILE: 
CLOSE QDATEFILE%
QALLDATES$="" : QDATEFILE%=73
QERR%=0
OPEN QDATEFILENAME$ FOR INPUT AS QDATEFILE%
IF QERR% THEN 
QLOGERROR$="Error: "+STR$(QERR%)+". Was not able to open Datecodes file "+QDATEFILENAME$ : GOSUB ZLOGERROR
RETURN
END IF
QALLDATES$=INPUT$(LOF(QDATEFILE%),QDATEFILE%)
CLOSE QDATEFILE%
RETURN
ZLOGERROR: 
GOSUB ZPANTALLA
RETURN
ZINCREMENTSERIALNUMBER: 
QSERIALNUMBER%=QSERIALNUMBER%+1
IF QSERIALNUMBER%>99999 THEN 
QSERIALNUMBER%=1
END IF
GOSUB ZSAVESERIALNUMBER
RETURN
